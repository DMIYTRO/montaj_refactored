# Montaj Refactored

Автоматизированная система спуска полос (монтажа) для Adobe InDesign.

## Описание

Скрипт автоматически обрабатывает PDF-файлы:
- Выполняет спуск полос на печатные листы
- Создает JDF-файлы для цифровых машин (Fiery RIP)
- Экспортирует PDF/PS на сетевые папки
- Добавляет метки реза и текстовые метки
- Логирует процесс обработки

## Структура проекта

```
montaj_refactored/
├── Main.jsx          # Точка входа, основной цикл обработки
├── Config.jsx        # Конфигурация, пути, списки материалов
├── Imposition.jsx    # Алгоритмы спуска полос
├── JDF.jsx           # Создание JDF, экспорт PDF/PS
├── Utils.jsx         # Вспомогательные функции
├── Logger.jsx        # Логирование
└── README.md         # Документация
```

## Конвенция имен файлов

```
(ЗАКАЗ-ПОЗИЦИЯ)_ЦВЕТНОСТЬ_МАТЕРИАЛ_(ШИРИНАxВЫСОТА)_TТИРАЖ_(ТЕГИ).pdf
```

**Пример:** `(12345-1)_4-4_300_mel_(210x99)_T500_(SRA3).pdf`

- `(12345-1)` - номер заказа и позиция
- `4-4` - цветность (CMYK обе стороны)
- `300_mel` - материал (мелованная 300 г/м²)
- `(210x99)` - размер в мм
- `T500` - тираж 500 экземпляров
- `(SRA3)` - теги (опционально)

## Установка

1. Скопировать все .jsx файлы в рабочую папку
2. Настроить пути в `Config.jsx` под вашу сеть
3. Создать файл `c:/myPath.txt` с путем к исходной папке

## Использование

### Запуск в InDesign

```javascript
File → Scripts → Other Script... → Main.jsx
```

### Конфигурация путей (c:/myPath.txt)

```
C:/path/to/source/folder
True
False
```

- Строка 1: путь к исходной папке
- Строка 2: показывать диалог (True/False)
- Строка 3: режим компиляции multi (True/False)

## Поддерживаемые материалы

### Стандартные
- Мелованная: 130-450 г/м² (глянцевая/матовая)
- Офсет: 80-300 г/м²

### Дизайнерские
- Raflatac (самоклейка)
- Stardream (металлизированная)
- Sirio, Plike, Dali (цветные)
- Tintoretto, Flora, Ispira
- Kraft (крафт)

### Специальные
- Mirror (зеркало)
- SYNAPS (синтетика)
- Ritrama, Oracal (пленки)
- Barh (бархат)

## Форматы бумаги

- **Kub:** 324x330 мм, 324x340 мм
- **SRA3:** 314x440 мм, 318x448 мм
- **SRA3+:** 324x473 мм, 318x487 мм
- **Специальные:** 328x389 мм, 320x690 мм (баннеры)

## Вывод

Скрипт создает:
- PDF для печати → `//10.20.2.60/work/output/`
- JDF для Fiery → `c:/jdf_*/`
- PS файлы → `//10.20.1.xx/printPS/`
- Лог → `processing_log.txt`

## Обработка ошибок

Файлы сортируются по папкам:
- `done/` - успешно обработанные
- `_ERRORS/` - ошибки обработки
- `multipage/` - многостраничные PDF
- `trubles/` - проблемы спуска
- `KonvLam/` - конвертная ламинация
- `white_lack/` - белый + лак

## Требования

- Adobe InDesign CS6+
- ExtendScript
- Fiery RIP с настроенными пресетами
- Сетевой доступ к папкам вывода

## Лицензия

Proprietary - для внутреннего использования типографии

## История версий

### v2.0 (Refactored)
- Модульная структура (6 файлов)
- Добавлено логирование
- Улучшена обработка ошибок
- Исправлены баги JDF и moveMyFiles